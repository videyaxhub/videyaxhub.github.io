<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VideoHub</title>
  <style>
    body { background: #000; color: #fff; margin: 0; font-family: Arial; }
    header { display: flex; justify-content: space-between; padding: 10px 20px; background: #ff6600; }
    .logo { font-weight: bold; font-size: 1.5em; }
    nav button { background: none; border: none; color: #fff; cursor: pointer; margin: 0 5px; font-size: 1em; }
    .grid-slider { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; padding: 20px; }
    .card { position: relative; cursor: pointer; border-radius: 10px; overflow: hidden; background: #111; transition: transform 0.3s; }
    .card video { width: 100%; height: auto; display: block; object-fit: cover; }
    .card-title { padding: 5px; text-align: center; font-size: 0.9em; }
    .play-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.6); border-radius: 50%; padding: 10px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 999; }
    .modal.active { display: flex; }
    .modal-content { position: relative; width: 80%; max-width: 900px; }
    .modal iframe { width: 100%; height: 500px; border: none; border-radius: 10px; }
    .modal-close { position: absolute; top: -40px; right: 0; font-size: 2em; color: white; background: none; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <div class="logo">ðŸ”¥ VideoHub</div>
    <nav>
      <button onclick="loadCategory('short')">Short</button>
      <button onclick="loadCategory('long')">Long</button>
      <button onclick="loadCategory('popular')">Popular</button>
    </nav>
  </header>

  <div class="grid-slider" id="slider"></div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <button class="modal-close" aria-label="Close Video">&times;</button>
      <iframe id="modal-iframe" allow="autoplay; fullscreen" allowfullscreen></iframe>
    </div>
  </div>

  <script src="videos_short.js"></script>
  <script src="videos_long.js"></script>
  <script src="videos_popular.js"></script>
  <script>
  let currentCategory = "short";
  let videos = [];
  let allPreviewVideos = [];

  function loadCategory(cat) {
    currentCategory = cat;
    if (cat === "short") videos = videosShort;
    if (cat === "long") videos = videosLong;
    if (cat === "popular") videos = videosPopular;
    renderGrid(videos);
  }

  function renderGrid(list) {
    const slider = document.getElementById("slider");
    slider.innerHTML = "";
    allPreviewVideos = [];

    list.forEach(movie => {
      const card = document.createElement("div");
      card.className = "card";

      // Video preview (lazy load)
      const vid = document.createElement("video");
      vid.setAttribute("preload", "metadata");
      vid.muted = true;
      vid.playsInline = true;
      vid.loop = true;
      vid.dataset.src = movie.video + "#t=0,1"; // simpan url di data-src
      card.appendChild(vid);
      allPreviewVideos.push(vid);

      const playBtn = document.createElement("div");
      playBtn.className = "play-btn";
      playBtn.innerHTML = `<svg viewBox="0 0 24 24" width="40" height="40"><path fill="white" d="M8 5v14l11-7z"/></svg>`;
      card.appendChild(playBtn);

      const title = document.createElement("div");
      title.className = "card-title";
      title.textContent = movie.title;
      card.appendChild(title);

      card.onclick = () => openModal(movie.video);
      slider.appendChild(card);
    });

    lazyLoadVideos();
  }

  function lazyLoadVideos() {
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        const video = entry.target;
        if (entry.isIntersecting) {
          if (!video.src) {
            video.src = video.dataset.src;
            video.play().catch(() => {});
          }
        } else {
          video.pause();
        }
      });
    }, { threshold: 0.5 });

    allPreviewVideos.forEach(video => observer.observe(video));
  }

  const modal = document.getElementById("modal");
  const modalIframe = document.getElementById("modal-iframe");
  modal.querySelector(".modal-close").onclick = closeModal;
  modal.onclick = e => { if (e.target === modal) closeModal(); };

  function openModal(videoUrl) {
    pauseAllPreviews();
    modal.classList.add("active");
    modalIframe.src = videoUrl + "?autoplay=1";
  }

  function closeModal() {
    modal.classList.remove("active");
    modalIframe.src = "";
    playAllPreviews();
  }

  function pauseAllPreviews() {
    allPreviewVideos.forEach(v => v.pause());
  }

  function playAllPreviews() {
    allPreviewVideos.forEach(v => {
      if (v.src) v.play().catch(() => {});
    });
  }

  loadCategory("short");
</script>

  </script>
</body>
</html>
